 <!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case Battles</title>
    <style>
        /* --- 1. –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ --- */
        :root {
            --bg-color: #17212b;
            --primary-card-bg: #242f3d;
            --secondary-card-bg: #1f2a36;
            --primary-accent: #5288c1;
            --secondary-accent: #3b6c9e;
            --text-color: #ffffff;
            --text-color-secondary: #aaaaaa;
            --star-color: #fddc76;
            --border-color: #3a4a5e;
            --green-color: #4dbb5f;
            --red-color: #db504a;
            --battle-color: #ff6b6b;
            --trade-color: #9b59b6;
        }

        @font-face {
            font-family: 'Inter';
            src: url('https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2') format('woff2');
            font-weight: 400;
            font-style: normal;
        }

        @font-face {
            font-family: 'Inter';
            src: url('https://fonts.gstatic.com/s/inter/v13/UcC73FwrK3iLTeHuS_fvQtMwCp50KnMa1ZL7W0Q5nw.woff2') format('woff2');
            font-weight: 700;
            font-style: normal;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            overscroll-behavior: none;
            user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
            -moz-user-select: none;
            line-height: 1.6;
        }

        /* --- 2. –õ—ç–π–∞—É—Ç –∏ –®–∞–ø–∫–∞ --- */
        .app-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .app-header {
            background-color: var(--primary-card-bg);
            padding: 16px 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .app-header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-color);
        }

        #settings-btn {
            font-size: 1.8rem;
            background: none;
            border: none;
            color: var(--text-color-secondary);
            cursor: pointer;
            transition: transform 0.2s ease, color 0.2s ease;
            padding: 8px;
            border-radius: 8px;
        }
        #settings-btn:hover {
            color: var(--text-color);
            transform: rotate(45deg);
            background-color: rgba(255,255,255,0.1);
        }

        .star-balance {
            display: flex;
            align-items: center;
            background-color: var(--secondary-card-bg);
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid var(--border-color);
        }

        .star-balance span {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--star-color);
            margin-left: 8px;
        }

        .app-main {
            flex-grow: 1;
            padding: 24px;
            display: grid;
            grid-template-columns: 1fr;
            gap: 24px;
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
        }

        /* --- 3. –°—Ç–∏–ª—å –∫–∞—Ä—Ç–æ—á–µ–∫ --- */
        .card {
            background-color: var(--primary-card-bg);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border: 1px solid var(--border-color);
        }

        .card h2 {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 12px;
            color: var(--text-color);
        }

        /* --- 4. –°–µ–∫—Ü–∏—è –ö–ª–∏–∫–µ—Ä–∞ --- */
        .clicker-section {
            text-align: center;
            position: relative;
            overflow: hidden;
            min-height: 250px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #clicker-btn {
            background: none;
            border: none;
            font-size: 8rem;
            cursor: pointer;
            transition: transform 0.1s ease-out;
            padding: 20px;
            border-radius: 50%;
            line-height: 1;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
        }

        #clicker-btn:active { 
            transform: scale(0.9); 
        }

        .floating-text {
            position: absolute;
            font-size: 2rem;
            font-weight: 700;
            color: var(--star-color);
            opacity: 1;
            animation: floatUp 1s ease-out forwards;
            pointer-events: none;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        @keyframes floatUp {
            from { opacity: 1; transform: translateY(0) scale(1); }
            to { opacity: 0; transform: translateY(-100px) scale(1.5); }
        }

        /* --- 5. –°–µ–∫—Ü–∏—è –ú–∞–≥–∞–∑–∏–Ω–∞ --- */
        .store-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 16px;
        }

        .case-item {
            background-color: var(--secondary-card-bg);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 12px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .case-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            border-color: var(--primary-accent);
        }
        
        .case-item span { 
            font-size: 4rem; 
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }
        .case-item p { 
            font-size: 1.1rem; 
            font-weight: 700; 
            color: var(--text-color);
        }

        .primary-btn {
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-color);
            background-color: var(--primary-accent);
            border: none;
            border-radius: 12px;
            padding: 14px 24px;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
        }

        .primary-btn:hover { 
            background-color: var(--secondary-accent); 
            transform: translateY(-2px);
        }
        .primary-btn:active { 
            transform: scale(0.98); 
        }
        .primary-btn:disabled { 
            background-color: #555; 
            cursor: not-allowed;
            transform: none;
        }

        .battle-btn {
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-color);
            background-color: var(--battle-color);
            border: none;
            border-radius: 12px;
            padding: 14px 24px;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
            margin-top: 10px;
        }

        .battle-btn:hover { 
            background-color: #ff5252; 
            transform: translateY(-2px);
        }

        .trade-btn {
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-color);
            background-color: var(--trade-color);
            border: none;
            border-radius: 12px;
            padding: 14px 24px;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
            margin-top: 10px;
        }

        .trade-btn:hover { 
            background-color: #8e44ad; 
            transform: translateY(-2px);
        }

        /* --- 6. –°–µ–∫—Ü–∏—è –ò–Ω–≤–µ–Ω—Ç–∞—Ä—è --- */
        #inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 16px;
        }

        .inventory-placeholder {
            color: var(--text-color-secondary);
            text-align: center;
            grid-column: 1 / -1;
            padding: 40px 0;
            font-style: italic;
        }

        .gift-item {
            background-color: var(--secondary-card-bg);
            border-radius: 12px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: all 0.2s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            border: 2px solid transparent;
        }
        .gift-item:hover {
            transform: translateY(-4px);
            border-color: var(--primary-accent);
            box-shadow: 0 6px 16px rgba(0,0,0,0.2);
        }

        .gift-item.selected {
            border-color: var(--trade-color);
            box-shadow: 0 0 15px var(--trade-color);
        }

        .gift-item-actions {
            display: flex;
            gap: 8px;
            width: 100%;
            margin-top: 8px;
        }

        .upgrade-btn {
            font-family: 'Inter', sans-serif;
            font-size: 0.8rem;
            font-weight: 700;
            color: #fff;
            background-color: var(--green-color);
            border: none;
            border-radius: 6px;
            padding: 6px 10px;
            cursor: pointer;
            flex: 1;
            transition: all 0.2s ease;
        }
        .upgrade-btn:hover {
            background-color: #3da34d;
            transform: translateY(-1px);
        }
        .upgrade-btn:disabled {
            background-color: #555;
            cursor: not-allowed;
            transform: none;
        }

        .sell-btn {
            font-family: 'Inter', sans-serif;
            font-size: 0.8rem;
            font-weight: 700;
            color: #fff;
            background-color: var(--red-color);
            border: none;
            border-radius: 6px;
            padding: 6px 10px;
            cursor: pointer;
            flex: 1;
            transition: all 0.2s ease;
        }
        .sell-btn:hover {
            background-color: #c93c36;
            transform: translateY(-1px);
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–¥–∞–∂–∏ */
        .gift-item.selling {
            animation: sellAnimation 0.6s ease forwards;
        }

        @keyframes sellAnimation {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
            100% { transform: scale(0); opacity: 0; }
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è —É–ª—É—á—à–µ–Ω–∏—è */
        .gift-item.is-upgrading {
            animation: flash 0.6s ease;
        }
        @keyframes flash {
            0% { background-color: var(--secondary-card-bg); }
            50% { background-color: var(--green-color); }
            100% { background-color: var(--secondary-card-bg); }
        }

        .gift-icon-wrapper {
            width: 100%;
            aspect-ratio: 1 / 1;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 12px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .gift-backdrop-pattern {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            font-size: 1.5rem;
            line-height: 1.8;
            opacity: 0.1;
            text-align: center;
            white-space: normal; 
            word-break: break-all;
        }
        
        .gift-base-icon {
            font-size: 3.5rem;
            line-height: 1;
            z-index: 2;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }

        .gift-corner-symbol {
            position: absolute;
            top: 5px;
            right: 8px;
            font-size: 1.5rem;
            z-index: 3;
            opacity: 0.8;
            filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3));
        }

        .gift-name {
            font-size: 0.9rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--text-color);
        }

        /* --- 7. –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ --- */
        .modal-backdrop {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 200;
            display: none;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-box {
            background-color: var(--primary-card-bg);
            padding: 0;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 800px;
            animation: modalFadeIn 0.3s ease-out;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border-color);
        }

        .modal-header {
            padding: 16px 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--secondary-card-bg);
            border-radius: 16px 16px 0 0;
        }
        .modal-header h3 { 
            font-size: 1.25rem; 
            color: var(--text-color);
        }

        .modal-close-btn {
            font-size: 1.5rem;
            font-weight: bold;
            background: none;
            border: none;
            color: var(--text-color-secondary);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        .modal-close-btn:hover { 
            color: var(--text-color); 
            background-color: rgba(255,255,255,0.1);
        }
        
        .modal-body {
            padding: 24px;
            overflow-y: auto;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; transform: scale(0.9) translateY(-20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        /* --- 8. –ê–ù–ò–ú–ê–¶–ò–Ø –û–¢–ö–†–´–¢–ò–Ø –ö–ï–ô–°–ê –ò –£–õ–£–ß–®–ï–ù–ò–Ø --- */
        .case-opening-content, .upgrade-opening-content {
            text-align: center;
            padding: 20px 0;
        }
        .case-opening-content p, .upgrade-opening-content p {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: var(--text-color);
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –ø–æ–¥–∞—Ä–∫–æ–≤ */
        .case-spinner-container, .upgrade-spinner-container {
            width: 100%;
            height: 140px;
            overflow: hidden;
            position: relative;
            margin: 20px 0;
            border-radius: 16px;
            background: linear-gradient(145deg, var(--secondary-card-bg), var(--primary-card-bg));
            border: 2px solid var(--border-color);
            box-shadow: inset 0 0 20px rgba(0,0,0,0.3);
        }
        
        .case-spinner-track, .upgrade-spinner-track {
            display: flex;
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            transition: transform 0.1s linear;
        }
        
        .case-spinner-item, .upgrade-spinner-item {
            width: 100px;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            flex-shrink: 0;
            padding: 15px;
            border-right: 1px solid var(--border-color);
            background: rgba(255,255,255,0.05);
            transition: all 0.3s ease;
        }
        
        .case-spinner-item:nth-child(even), .upgrade-spinner-item:nth-child(even) {
            background: rgba(255,255,255,0.02);
        }
        
        .case-spinner-icon, .upgrade-spinner-icon {
            font-size: 3.5rem;
            margin-bottom: 8px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
            transition: transform 0.3s ease;
        }
        
        .case-spinner-name, .upgrade-spinner-name {
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-color-secondary);
        }
        
        .case-spinner-highlight, .upgrade-spinner-highlight {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 110px;
            height: 100%;
            border: 3px solid var(--star-color);
            box-shadow: 0 0 25px var(--star-color), inset 0 0 15px var(--star-color);
            pointer-events: none;
            z-index: 10;
            border-radius: 12px;
            animation: pulseHighlight 1.5s ease-in-out infinite;
        }

        @keyframes pulseHighlight {
            0%, 100% { box-shadow: 0 0 25px var(--star-color), inset 0 0 15px var(--star-color); }
            50% { box-shadow: 0 0 35px var(--star-color), inset 0 0 20px var(--star-color); }
        }

        .case-reveal-content, .upgrade-reveal-content {
            text-align: center;
            padding: 30px 0;
            animation: revealAppear 0.8s ease-out;
        }

        @keyframes revealAppear {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        .case-reveal-content .modal-icon, .upgrade-reveal-content .modal-icon {
            font-size: 6rem;
            line-height: 1;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.4));
            animation: bounceIn 0.6s ease-out;
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); }
        }

        .case-reveal-content h4, .upgrade-reveal-content h4 {
            font-size: 1.5rem;
            margin-top: 20px;
            margin-bottom: 8px;
            color: var(--star-color);
        }
        .case-reveal-content p, .upgrade-reveal-content p {
            font-size: 1.1rem;
            color: #ccc;
            font-weight: 700;
        }

        /* --- 9. –û–∫–Ω–æ –æ—Å–º–æ—Ç—Ä–∞ –ø–æ–¥–∞—Ä–∫–∞ --- */
        .inspect-gift-art {
            width: 100%;
            max-width: 250px;
            margin: 0 auto 24px auto;
        }
        .inspect-gift-art .gift-icon-wrapper {
            border-radius: 16px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }
        .inspect-gift-art .gift-base-icon {
            font-size: 8rem;
        }
        .inspect-gift-art .gift-corner-symbol {
            font-size: 3rem;
            top: 10px; right: 15px;
        }
        .inspect-gift-art .gift-backdrop-pattern {
            font-size: 3rem;
            line-height: 1.5;
            opacity: 0.15;
        }

        .inspect-gift-info {
            background-color: var(--secondary-card-bg);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }
        .inspect-info-grid {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 12px;
        }
        .inspect-info-grid dt {
            font-weight: 700;
            color: var(--text-color-secondary);
        }
        .inspect-info-grid dd {
            font-weight: 700;
            text-align: right;
            color: var(--text-color);
        }
        .inspect-info-grid dd.value {
            color: var(--star-color);
            font-size: 1.1rem;
        }
        .inspect-info-grid dd.value.multiplier {
            color: var(--green-color);
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .inspect-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .inspect-actions .primary-btn {
            flex: 1;
        }

        .sell-confirm-modal {
            text-align: center;
            padding: 20px 0;
        }

        .sell-confirm-modal .modal-icon {
            font-size: 4rem;
            margin-bottom: 16px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }

        .sell-price {
            font-size: 2rem;
            font-weight: 700;
            color: var(--star-color);
            margin: 16px 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .sell-warning {
            color: var(--red-color);
            font-size: 0.9rem;
            margin-top: 12px;
            font-style: italic;
        }

        /* --- 10. –û–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ --- */
        .settings-content .lang-switcher {
            display: flex;
            gap: 10px;
        }
        .lang-btn {
            flex: 1;
            font-size: 1rem;
            font-weight: 700;
            padding: 12px;
            border-radius: 8px;
            border: 2px solid var(--border-color);
            background-color: var(--secondary-card-bg);
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .lang-btn:hover {
            border-color: var(--primary-accent);
            background-color: var(--primary-card-bg);
        }
        .lang-btn.active {
            border-color: var(--primary-accent);
            background-color: var(--primary-accent);
        }

        /* --- 11. –û–∫–Ω–æ –±–∏—Ç–≤—ã --- */
        .battle-section {
            margin-top: 20px;
        }

        .battle-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .battle-option {
            background-color: var(--secondary-card-bg);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            border: 2px solid var(--border-color);
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .battle-option:hover {
            border-color: var(--battle-color);
        }

        .battle-option.selected {
            border-color: var(--battle-color);
            background-color: rgba(255, 107, 107, 0.1);
        }

        .battle-option-icon {
            font-size: 2.5rem;
            margin-bottom: 8px;
        }

        .battle-option-name {
            font-size: 0.9rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .battle-option-cost {
            font-size: 0.8rem;
            color: var(--star-color);
        }

        .battle-count-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin: 20px 0;
        }

        .count-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background-color: var(--primary-accent);
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .count-btn:hover {
            background-color: var(--secondary-accent);
            transform: scale(1.1);
        }

        .count-btn:disabled {
            background-color: #555;
            cursor: not-allowed;
            transform: none;
        }

        .battle-count {
            font-size: 1.5rem;
            font-weight: 700;
            min-width: 50px;
            text-align: center;
        }

        .battle-total {
            text-align: center;
            font-size: 1.2rem;
            margin: 16px 0;
            color: var(--star-color);
        }

        .battle-result {
            text-align: center;
            padding: 20px 0;
        }

        .battle-comparison {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
        }

        .battle-player, .battle-bot {
            flex: 1;
            text-align: center;
            padding: 16px;
            border-radius: 12px;
            background-color: var(--secondary-card-bg);
        }

        .battle-player {
            border: 2px solid var(--primary-accent);
        }

        .battle-bot {
            border: 2px solid var(--battle-color);
        }

        .battle-player h4, .battle-bot h4 {
            margin-bottom: 12px;
            font-size: 1.1rem;
        }

        .battle-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--star-color);
            margin: 8px 0;
        }

        .battle-winner {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--green-color);
            margin: 16px 0;
            animation: pulse 1.5s infinite;
        }

        .battle-loser {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--red-color);
            margin: 16px 0;
        }

        /* --- 12. –û–∫–Ω–æ —Ç—Ä–µ–π–¥–æ–≤ --- */
        .trade-section {
            margin-top: 20px;
        }

        .trade-container {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .trade-column {
            flex: 1;
            background-color: var(--secondary-card-bg);
            border-radius: 12px;
            padding: 16px;
            border: 2px solid var(--border-color);
        }

        .trade-column.player {
            border-color: var(--primary-accent);
        }

        .trade-column.bot {
            border-color: var(--trade-color);
        }

        .trade-column h4 {
            text-align: center;
            margin-bottom: 16px;
            font-size: 1.1rem;
        }

        .trade-gifts {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 12px;
            min-height: 150px;
        }

        .trade-gift-item {
            background-color: var(--primary-card-bg);
            border-radius: 8px;
            padding: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }

        .trade-gift-item:hover {
            border-color: var(--primary-accent);
        }

        .trade-gift-item.selected {
            border-color: var(--trade-color);
            box-shadow: 0 0 10px var(--trade-color);
        }

        .trade-gift-icon {
            font-size: 2.5rem;
            margin-bottom: 5px;
        }

        .trade-gift-name {
            font-size: 0.7rem;
            font-weight: 700;
        }

        .trade-summary {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            padding: 16px;
            background-color: var(--secondary-card-bg);
            border-radius: 12px;
        }

        .trade-value {
            text-align: center;
        }

        .trade-value-label {
            font-size: 0.9rem;
            color: var(--text-color-secondary);
            margin-bottom: 5px;
        }

        .trade-value-amount {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--star-color);
        }

        .trade-actions {
            display: flex;
            gap: 12px;
        }

        .trade-actions .primary-btn {
            flex: 1;
        }

        .accept-btn {
            background-color: var(--green-color);
        }

        .accept-btn:hover {
            background-color: #3da34d;
        }

        .reject-btn {
            background-color: var(--red-color);
        }

        .reject-btn:hover {
            background-color: #c93c36;
        }

        .trade-result {
            text-align: center;
            padding: 20px 0;
        }

        .trade-success {
            color: var(--green-color);
            font-size: 1.3rem;
            font-weight: 700;
            margin: 16px 0;
        }

        /* --- 13. –ö–ª–∞—Å—Å—ã –¥–ª—è –§–æ–Ω–æ–≤ (Backdrops) --- */
        .bg-default { background-color: #4a5a6a; }
        .bg-green-shamrock { background-color: #77ab59; }
        .bg-purple-mist { background-color: #7b5aa1; }
        .bg-red-fire { background-color: #b05a5a; }
        .bg-yellow-sun { background-color: #fddc76; color: #333; }
        .bg-blue-ocean { background-color: #4a6a9a; }
        .bg-golden { background: linear-gradient(145deg, #ffd700, #ffaa00); color: #333; }
        .bg-rainbow { background: linear-gradient(145deg, #ff0000, #ff9900, #ffff00, #00ff00, #00ffff, #0000ff, #9900ff); }
        .bg-galaxy { background: linear-gradient(145deg, #000428, #004e92); }
        .bg-black-void { background: #000000; }
        .bg-neon { background: linear-gradient(145deg, #ff00ff, #00ffff); }
        .bg-lava { background: linear-gradient(145deg, #ff4500, #ff8c00); }
        .bg-forest { background: linear-gradient(145deg, #228b22, #32cd32); }
        .bg-cosmic { background: linear-gradient(145deg, #8a2be2, #4b0082); }
        .bg-crystal { background: linear-gradient(145deg, #e0ffff, #afeeee); color: #333; }
        
        /* --- 14. –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å --- */
        @media (min-width: 768px) {
            .app-main {
                grid-template-columns: 1fr 1fr;
            }
            .inventory-section {
                grid-column: 1 / 3;
            }
        }
        
        @media (min-width: 1024px) {
            .app-main {
                grid-template-columns: 1fr 1fr 1.5fr;
            }
            .inventory-section {
                grid-column: 3 / 4;
                grid-row: 1 / 3;
                max-height: calc(100vh - 120px);
                overflow-y: auto;
            }
            #inventory-grid {
                grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            }
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ */
        .inventory-section::-webkit-scrollbar {
            width: 8px;
        }
        
        .inventory-section::-webkit-scrollbar-track {
            background: var(--secondary-card-bg);
            border-radius: 4px;
        }
        
        .inventory-section::-webkit-scrollbar-thumb {
            background: var(--primary-accent);
            border-radius: 4px;
        }
        
        .inventory-section::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-accent);
        }

        /* –°—Ç–∏–ª—å –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ–¥–∞—Ç—å –≤—Å–µ" */
        .sell-all-container {
            margin-bottom: 20px;
            text-align: center;
        }
    </style>
</head>
<body>

    <div class="app-container">
        <header class="app-header">
            <div class="header-left">
                <h1>Case Battles</h1>
                <button id="settings-btn" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öôÔ∏è</button>
            </div>
            <div class="star-balance">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" fill="#fddc76"/>
                </svg>
                <span id="star-count">0</span>
            </div>
        </header>

        <main class="app-main">
            <section class="card clicker-section" id="clicker-container">
                <h2 data-t="clicker_title">Star Clicker</h2>
                <p data-t="clicker_desc">Tap the star to earn!</p>
                <button id="clicker-btn">üåü</button>
            </section>

            <section class="card store-section">
                <h2 data-t="store_title">Case Shop</h2>
                <div class="store-grid" id="store-grid">
                    <!-- –ö–µ–π—Å—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                </div>
                <button class="battle-btn" id="battle-btn">‚öîÔ∏è –ë–∏—Ç–≤–∞</button>
                <button class="trade-btn" id="trade-btn">üîÑ –¢—Ä–µ–π–¥</button>
            </section>

            <section class="card inventory-section">
                <h2 data-t="inventory_title">Your Gifts</h2>
                <div class="sell-all-container" id="sell-all-container">
                    <!-- –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ–¥–∞—Ç—å –≤—Å–µ" –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∑–¥–µ—Å—å -->
                </div>
                <div id="inventory-grid">
                    <p class="inventory-placeholder" data-t="inventory_empty">Your inventory is empty. Buy a case to get your first gift!</p>
                </div>
            </section>
        </main>
    </div>

    <div class="modal-backdrop" id="modal-backdrop">
        <div class="modal-box" id="modal-box">
            <div class="modal-header">
                <h3 id="modal-title">Modal Title</h3>
                <button class="modal-close-btn" data-modal-close> &times; </button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ -->
            </div>
        </div>
    </div>
    

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- 1. –ë–ê–ó–´ –î–ê–ù–ù–´–• –ò–ì–†–´ ---
            const TRANSLATIONS = {
                'ru': {
                    'clicker_title': '–ó–≤–µ–∑–¥–Ω—ã–π –ö–ª–∏–∫–µ—Ä',
                    'clicker_desc': '–ù–∞–∂–º–∏ –Ω–∞ –∑–≤–µ–∑–¥—É, —á—Ç–æ–±—ã –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å!',
                    'store_title': '–ú–∞–≥–∞–∑–∏–Ω –ö–µ–π—Å–æ–≤',
                    'inventory_title': '–í–∞—à–∏ –ü–æ–¥–∞—Ä–∫–∏',
                    'inventory_empty': '–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç...',
                    'case_common_name': '–û–±—ã—á–Ω—ã–π –ö–µ–π—Å',
                    'case_rare_name': '–†–µ–¥–∫–∏–π –ö–µ–π—Å',
                    'case_epic_name': '–≠–ø–∏—á–µ—Å–∫–∏–π –ö–µ–π—Å',
                    'case_legendary_name': '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –ö–µ–π—Å',
                    'case_mystery_name': '–¢–∞–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –ö–µ–π—Å',
                    'case_premium_name': '–ü—Ä–µ–º–∏—É–º –ö–µ–π—Å',
                    'case_divine_name': '–ë–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –ö–µ–π—Å',
                    'case_ancient_name': '–î—Ä–µ–≤–Ω–∏–π –ö–µ–π—Å',
                    'buy_btn': '–ö—É–ø–∏—Ç—å',
                    'upgrade_btn': '–£–ª—É—á—à–∏—Ç—å',
                    'sell_btn': '–ü—Ä–æ–¥–∞—Ç—å',
                    'battle_btn': '–ë–∏—Ç–≤–∞',
                    'trade_btn': '–¢—Ä–µ–π–¥',
                    'trade_title': '–¢—Ä–µ–π–¥',
                    'trade_select': '–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∞—Ä–∫–∏ –¥–ª—è –æ–±–º–µ–Ω–∞',
                    'trade_player': '–í–∞—à–∏ –ø–æ–¥–∞—Ä–∫–∏',
                    'trade_bot': '–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –±–æ—Ç–∞',
                    'trade_value': '–°—Ç–æ–∏–º–æ—Å—Ç—å',
                    'trade_accept': '–ü—Ä–∏–Ω—è—Ç—å',
                    'trade_reject': '–û—Ç–∫–ª–æ–Ω–∏—Ç—å',
                    'trade_success': '–¢—Ä–µ–π–¥ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω!',
                    'trade_no_selection': '–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø–æ–¥–∞—Ä–æ–∫ –¥–ª—è –æ–±–º–µ–Ω–∞',
                    'trade_rejected': '–°–¥–µ–ª–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞',
                    'battle_title': '–ë–∏—Ç–≤–∞',
                    'battle_select_cases': '–í—ã–±–µ—Ä–∏—Ç–µ –∫–µ–π—Å—ã –¥–ª—è –±–∏—Ç–≤—ã',
                    'battle_select_count': '–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ',
                    'battle_total_cost': '–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å',
                    'battle_start': '–ù–∞—á–∞—Ç—å –±–∏—Ç–≤—É',
                    'battle_processing': '–ò–¥–µ—Ç –±–∏—Ç–≤–∞...',
                    'battle_player': '–ò–≥—Ä–æ–∫',
                    'battle_bot': '–ë–æ—Ç',
                    'battle_winner': '–ü–æ–±–µ–¥–∏—Ç–µ–ª—å',
                    'battle_loser': '–ü—Ä–æ–∏–≥—Ä–∞–≤—à–∏–π',
                    'battle_win_message': '–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ –±–∏—Ç–≤—É –∏ –∑–∞–±–∏—Ä–∞–µ—Ç–µ –≤—Å–µ –ø–æ–¥–∞—Ä–∫–∏!',
                    'battle_lose_message': '–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –≤—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏. –ë–æ—Ç –∑–∞–±–∏—Ä–∞–µ—Ç –≤—Å–µ –ø–æ–¥–∞—Ä–∫–∏.',
                    'battle_draw_message': '–ù–∏—á—å—è! –ö–∞–∂–¥—ã–π –æ—Å—Ç–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–≤–æ–∏—Ö –ø–æ–¥–∞—Ä–∫–∞—Ö.',
                    'sell_confirm_title': '–ü—Ä–æ–¥–∞–∂–∞ –ø–æ–¥–∞—Ä–∫–∞',
                    'sell_confirm_text': '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥–∞—Ç—å —ç—Ç–æ—Ç –ø–æ–¥–∞—Ä–æ–∫?',
                    'sell_price': '–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏',
                    'sell_warning': '–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!',
                    'sell_success': '–ü–æ–¥–∞—Ä–æ–∫ –ø—Ä–æ–¥–∞–Ω!',
                    'settings_title': '–ù–∞—Å—Ç—Ä–æ–π–∫–∏',
                    'settings_lang': '–Ø–∑—ã–∫',
                    'opening_case': '–û—Ç–∫—Ä—ã–≤–∞–µ–º –∫–µ–π—Å...',
                    'upgrading_gift': '–£–ª—É—á—à–∞–µ–º –ø–æ–¥–∞—Ä–æ–∫...',
                    'you_got': '–í—ã –ø–æ–ª—É—á–∏–ª–∏:',
                    'new_backdrop': '–ù–æ–≤—ã–π —Ñ–æ–Ω:',
                    'new_symbol': '–ù–æ–≤—ã–π —Å–∏–º–≤–æ–ª:',
                    'inspect_title': '–û—Å–º–æ—Ç—Ä –ü–æ–¥–∞—Ä–∫–∞',
                    'inspect_owner': '–í–ª–∞–¥–µ–ª–µ—Ü',
                    'inspect_owner_you': '–í—ã',
                    'inspect_model': '–ú–æ–¥–µ–ª—å',
                    'inspect_backdrop': '–§–æ–Ω',
                    'inspect_symbol': '–°–∏–º–≤–æ–ª',
                    'inspect_availability': '–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å',
                    'inspect_value': '–°—Ç–æ–∏–º–æ—Å—Ç—å',
                    'inspect_upgrade_cost': '–°—Ç–æ–∏–º–æ—Å—Ç—å —É–ª—É—á—à–µ–Ω–∏—è',
                    'not_enough_stars': '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤–µ–∑–¥!',
                    'alert_need_stars': '–ù—É–∂–Ω–æ',
                    'alert_to_buy': '–¥–ª—è –ø–æ–∫—É–ø–∫–∏',
                    'alert_to_upgrade': '–¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è'
                },
                'en': {
                    'clicker_title': 'Star Clicker',
                    'clicker_desc': 'Tap the star to earn!',
                    'store_title': 'Case Shop',
                    'inventory_title': 'Your Gifts',
                    'inventory_empty': 'Your inventory is empty. Buy a case to get your first gift!',
                    'case_common_name': 'Common Case',
                    'case_rare_name': 'Rare Case',
                    'case_epic_name': 'Epic Case',
                    'case_legendary_name': 'Legendary Case',
                    'case_mystery_name': 'Mystery Case',
                    'case_premium_name': 'Premium Case',
                    'case_divine_name': 'Divine Case',
                    'case_ancient_name': 'Ancient Case',
                    'buy_btn': 'Buy',
                    'upgrade_btn': 'Upgrade',
                    'sell_btn': 'Sell',
                    'battle_btn': 'Battle',
                    'trade_btn': 'Trade',
                    'trade_title': 'Trade',
                    'trade_select': 'Select gifts for trade',
                    'trade_player': 'Your gifts',
                    'trade_bot': 'Bot offer',
                    'trade_value': 'Value',
                    'trade_accept': 'Accept',
                    'trade_reject': 'Reject',
                    'trade_success': 'Trade completed successfully!',
                    'trade_no_selection': 'Select at least one gift for trade',
                    'trade_rejected': 'Trade rejected',
                    'battle_title': 'Battle',
                    'battle_select_cases': 'Select cases for battle',
                    'battle_select_count': 'Select quantity',
                    'battle_total_cost': 'Total cost',
                    'battle_start': 'Start Battle',
                    'battle_processing': 'Battle in progress...',
                    'battle_player': 'Player',
                    'battle_bot': 'Bot',
                    'battle_winner': 'Winner',
                    'battle_loser': 'Loser',
                    'battle_win_message': 'Congratulations! You won the battle and take all the gifts!',
                    'battle_lose_message': 'Unfortunately, you lost. The bot takes all the gifts.',
                    'battle_draw_message': 'Draw! Everyone keeps their gifts.',
                    'sell_confirm_title': 'Sell Gift',
                    'sell_confirm_text': 'Are you sure you want to sell this gift?',
                    'sell_price': 'Sell Price',
                    'sell_warning': 'This action cannot be undone!',
                    'sell_success': 'Gift sold!',
                    'settings_title': 'Settings',
                    'settings_lang': 'Language',
                    'opening_case': 'Opening case...',
                    'upgrading_gift': 'Upgrading gift...',
                    'you_got': 'You got:',
                    'new_backdrop': 'New backdrop:',
                    'new_symbol': 'New symbol:',
                    'inspect_title': 'Inspect Gift',
                    'inspect_owner': 'Owner',
                    'inspect_owner_you': 'You',
                    'inspect_model': 'Model',
                    'inspect_backdrop': 'Backdrop',
                    'inspect_symbol': 'Symbol',
                    'inspect_availability': 'Availability',
                    'inspect_value': 'Value',
                    'inspect_upgrade_cost': 'Upgrade cost',
                    'not_enough_stars': 'Not enough stars!',
                    'alert_need_stars': 'You need',
                    'alert_to_buy': 'to buy',
                    'alert_to_upgrade': 'to upgrade'
                }
            };

            const GIFT_CATALOG = {
                'duck': { baseName: 'Duck', icon: 'ü¶Ü', baseColor: 'yellow', rarity: 1.1 },
                'crystal': { baseName: 'Crystal', icon: 'üíé', baseColor: 'blue', rarity: 1.3 },
                'rocket': { baseName: 'Rocket', icon: 'üöÄ', baseColor: 'red', rarity: 1.2 },
                'cat': { baseName: 'Cat', icon: 'üê±', baseColor: 'grey', rarity: 1.1 },
                'snake': { baseName: 'Lunar Snake', icon: 'üêç', baseColor: 'purple', rarity: 1.5 },
                'whale': { baseName: 'Whale', icon: 'üê≥', baseColor: 'blue', rarity: 1.4 },
                'dragon': { baseName: 'Dragon', icon: 'üêâ', baseColor: 'red', rarity: 1.8 },
                'unicorn': { baseName: 'Unicorn', icon: 'ü¶Ñ', baseColor: 'white', rarity: 1.7 },
                'phoenix': { baseName: 'Phoenix', icon: 'üî•', baseColor: 'orange', rarity: 2.0 },
                'robot': { baseName: 'Robot', icon: 'ü§ñ', baseColor: 'grey', rarity: 1.6 },
                'alien': { baseName: 'Alien', icon: 'üëΩ', baseColor: 'green', rarity: 1.9 },
                'ghost': { baseName: 'Ghost', icon: 'üëª', baseColor: 'white', rarity: 1.4 },
                'panda': { baseName: 'Panda', icon: 'üêº', baseColor: 'black', rarity: 1.3 },
                'tiger': { baseName: 'Tiger', icon: 'üêØ', baseColor: 'orange', rarity: 1.6 },
                'fox': { baseName: 'Fox', icon: 'ü¶ä', baseColor: 'orange', rarity: 1.4 },
                'owl': { baseName: 'Owl', icon: 'ü¶â', baseColor: 'brown', rarity: 1.5 },
                'peacock': { baseName: 'Peacock', icon: 'ü¶ö', baseColor: 'blue', rarity: 1.8 },
                'dinosaur': { baseName: 'Dinosaur', icon: 'ü¶ï', baseColor: 'green', rarity: 1.7 }
            };

            const BACKDROPS = {
                'default': { name: 'Default', color: 'grey', css_class: 'bg-default', pattern: '‚Ä¢', rarity: 1, weight: 25 },
                'green_shamrock': { name: 'Shamrock Green', color: 'green', css_class: 'bg-green-shamrock', pattern: 'üçÄ', rarity: 1.5, weight: 20 },
                'purple_mist': { name: 'Purple Mist', color: 'purple', css_class: 'bg-purple-mist', pattern: '‚ú®', rarity: 2, weight: 15 },
                'red_fire': { name: 'Red Fire', color: 'red', css_class: 'bg-red-fire', pattern: 'üî•', rarity: 2, weight: 15 },
                'blue_ocean': { name: 'Blue Ocean', color: 'blue', css_class: 'bg-blue-ocean', pattern: 'üåä', rarity: 1.8, weight: 12 },
                'yellow_sun': { name: 'Yellow Sun', color: 'yellow', css_class: 'bg-yellow-sun', pattern: '‚òÄÔ∏è', rarity: 2.5, weight: 8 },
                'golden': { name: 'Golden', color: 'yellow', css_class: 'bg-golden', pattern: '‚≠ê', rarity: 3, weight: 4 },
                'rainbow': { name: 'Rainbow', color: 'rainbow', css_class: 'bg-rainbow', pattern: 'üåà', rarity: 3.5, weight: 2 },
                'galaxy': { name: 'Galaxy', color: 'blue', css_class: 'bg-galaxy', pattern: 'üåå', rarity: 4, weight: 1 },
                'black_void': { name: 'Black Void', color: 'black', css_class: 'bg-black-void', pattern: '‚ö´', rarity: 10, weight: 0.5 },
                'neon': { name: 'Neon', color: 'purple', css_class: 'bg-neon', pattern: 'üí†', rarity: 3.2, weight: 3 },
                'lava': { name: 'Lava', color: 'red', css_class: 'bg-lava', pattern: 'üåã', rarity: 2.8, weight: 5 },
                'forest': { name: 'Forest', color: 'green', css_class: 'bg-forest', pattern: 'üå≤', rarity: 2.2, weight: 8 },
                'cosmic': { name: 'Cosmic', color: 'purple', css_class: 'bg-cosmic', pattern: '‚òÑÔ∏è', rarity: 3.8, weight: 2 },
                'crystal': { name: 'Crystal', color: 'blue', css_class: 'bg-crystal', pattern: '‚ùÑÔ∏è', rarity: 2.5, weight: 6 }
            };

            const SYMBOLS = {
                'none': { name: 'None', icon: '', rarity: 1, weight: 30 },
                'coin_purse': { name: 'Coin Purse', icon: 'üëõ', rarity: 1.8, weight: 25 },
                'gem': { name: 'Gem', icon: 'üíé', rarity: 2.2, weight: 20 },
                'crown': { name: 'Crown', icon: 'üëë', rarity: 3, weight: 15 },
                'diamond': { name: 'Diamond', icon: 'üí†', rarity: 3.5, weight: 8 },
                'trophy': { name: 'Trophy', icon: 'üèÜ', rarity: 4, weight: 2 },
                'star': { name: 'Star', icon: '‚≠ê', rarity: 2.5, weight: 12 },
                'heart': { name: 'Heart', icon: '‚ù§Ô∏è', rarity: 2.0, weight: 18 },
                'lightning': { name: 'Lightning', icon: '‚ö°', rarity: 2.8, weight: 10 },
                'moon': { name: 'Moon', icon: 'üåô', rarity: 2.3, weight: 14 },
                'sun': { name: 'Sun', icon: '‚òÄÔ∏è', rarity: 2.6, weight: 11 }
            };

            const CASES = {
                'common': { 
                    nameKey: 'case_common_name', 
                    icon: 'üéÅ', 
                    cost: 100, 
                    loot: { 
                        gifts: ['duck', 'cat', 'fox'], 
                        backdrops: ['default', 'green_shamrock'], 
                        symbols: ['none', 'coin_purse', 'heart'] 
                    } 
                },
                'rare': { 
                    nameKey: 'case_rare_name', 
                    icon: 'üéÄ', 
                    cost: 500, 
                    loot: { 
                        gifts: ['duck', 'cat', 'rocket', 'whale', 'ghost'], 
                        backdrops: ['default', 'green_shamrock', 'blue_ocean', 'purple_mist'], 
                        symbols: ['none', 'coin_purse', 'gem', 'star'] 
                    } 
                },
                'epic': { 
                    nameKey: 'case_epic_name', 
                    icon: 'üì¶', 
                    cost: 2000, 
                    loot: { 
                        gifts: ['crystal', 'snake', 'whale', 'robot', 'tiger', 'owl'], 
                        backdrops: ['purple_mist', 'red_fire', 'yellow_sun', 'blue_ocean', 'forest'], 
                        symbols: ['coin_purse', 'gem', 'crown', 'lightning'] 
                    } 
                },
                'legendary': { 
                    nameKey: 'case_legendary_name', 
                    icon: 'üî•', 
                    cost: 5000, 
                    loot: { 
                        gifts: ['dragon', 'unicorn', 'phoenix', 'alien', 'peacock'], 
                        backdrops: ['yellow_sun', 'golden', 'rainbow', 'lava'], 
                        symbols: ['gem', 'crown', 'diamond', 'moon'] 
                    } 
                },
                'mystery': { 
                    nameKey: 'case_mystery_name', 
                    icon: '‚ùì', 
                    cost: 1500, 
                    loot: { 
                        gifts: ['duck', 'cat', 'rocket', 'whale', 'crystal', 'snake', 'robot', 'panda'], 
                        backdrops: ['default', 'green_shamrock', 'blue_ocean', 'purple_mist', 'red_fire', 'forest'], 
                        symbols: ['none', 'coin_purse', 'gem', 'crown', 'heart', 'star'] 
                    } 
                },
                'premium': { 
                    nameKey: 'case_premium_name', 
                    icon: 'üíé', 
                    cost: 3500, 
                    loot: { 
                        gifts: ['snake', 'whale', 'dragon', 'unicorn', 'phoenix', 'dinosaur'], 
                        backdrops: ['golden', 'rainbow', 'galaxy', 'neon'], 
                        symbols: ['crown', 'diamond', 'trophy', 'sun'] 
                    } 
                },
                'divine': { 
                    nameKey: 'case_divine_name', 
                    icon: '‚ú®', 
                    cost: 8000, 
                    loot: { 
                        gifts: ['phoenix', 'dragon', 'unicorn', 'alien', 'peacock'], 
                        backdrops: ['galaxy', 'cosmic', 'black_void', 'crystal'], 
                        symbols: ['diamond', 'trophy', 'sun', 'lightning'] 
                    } 
                },
                'ancient': { 
                    nameKey: 'case_ancient_name', 
                    icon: 'üè∫', 
                    cost: 12000, 
                    loot: { 
                        gifts: ['dragon', 'phoenix', 'dinosaur', 'alien'], 
                        backdrops: ['black_void', 'cosmic', 'galaxy', 'neon'], 
                        symbols: ['trophy', 'diamond', 'crown', 'sun'] 
                    } 
                }
            };

            // --- 2. –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ---
            let stars = 1000;
            let inventory = [];
            let currentLanguage = 'ru';
            
            // --- 3. DOM –≠–õ–ï–ú–ï–ù–¢–´ ---
            const starCountDisplay = document.getElementById('star-count');
            const clickerContainer = document.getElementById('clicker-container');
            const clickerBtn = document.getElementById('clicker-btn');
            const storeGrid = document.getElementById('store-grid');
            const inventoryGrid = document.getElementById('inventory-grid');
            const sellAllContainer = document.getElementById('sell-all-container');
            const modalBackdrop = document.getElementById('modal-backdrop');
            const modalBox = document.getElementById('modal-box');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body');
            const settingsBtn = document.getElementById('settings-btn');
            const battleBtn = document.getElementById('battle-btn');
            const tradeBtn = document.getElementById('trade-btn');

            // --- 4. –Ø–î–†–û - –§–£–ù–ö–¶–ò–ò –ü–ï–†–ï–í–û–î–ê (i18n) ---
            function t(key) {
                return TRANSLATIONS[currentLanguage][key] || key;
            }

            function updateLanguage() {
                document.querySelectorAll('[data-t]').forEach(el => {
                    const key = el.dataset.t;
                    if (el.placeholder) {
                        el.placeholder = t(key);
                    } else {
                        el.textContent = t(key);
                    }
                });
                renderStore();
                renderInventory();
                document.documentElement.lang = currentLanguage;
            }

            function setLanguage(lang) {
                currentLanguage = lang;
                localStorage.setItem('giftsBattle_lang', lang);
                updateLanguage();
            }

            // --- 5. –Ø–î–†–û - –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–û–°–¢–û–Ø–ù–ò–ï–ú ---
            function updateStarDisplay() {
                starCountDisplay.textContent = stars;
                document.querySelectorAll('.case-item button').forEach(btn => {
                    btn.disabled = stars < parseInt(btn.dataset.cost, 10);
                });
            }

            function saveGame() {
                try {
                    localStorage.setItem('giftsBattle_stars', stars);
                    localStorage.setItem('giftsBattle_inventory', JSON.stringify(inventory));
                } catch (e) {
                    console.error("Failed to save game:", e);
                }
            }

            function loadGame() {
                try {
                    const savedLang = localStorage.getItem('giftsBattle_lang');
                    if (savedLang) {
                        currentLanguage = savedLang;
                    }

                    const savedStars = localStorage.getItem('giftsBattle_stars');
                    const savedInventory = localStorage.getItem('giftsBattle_inventory');
                    if (savedStars !== null) {
                        stars = parseInt(savedStars, 10) || 0;
                    }
                    if (savedInventory) {
                        inventory = JSON.parse(savedInventory) || [];
                    }
                } catch (e) {
                    console.error("Failed to load game:", e);
                    stars = 1000;
                    inventory = [];
                }
                setLanguage(currentLanguage);
                updateStarDisplay();
                renderStore();
                renderInventory();
            }

            // --- 6. –Ø–î–†–û - –†–ï–ù–î–ï–† (–û–¢–†–ò–°–û–í–ö–ê) ---
            function renderStore() {
                storeGrid.innerHTML = '';
                for (const caseId in CASES) {
                    const caseData = CASES[caseId];
                    const caseEl = document.createElement('div');
                    caseEl.className = 'case-item';
                    caseEl.innerHTML = `
                        <span>${caseData.icon}</span>
                        <p>${t(caseData.nameKey)}</p>
                        <button class="primary-btn" data-case-id="${caseId}" data-cost="${caseData.cost}">
                            ${t('buy_btn')} (${caseData.cost} üåü)
                        </button>
                    `;
                    storeGrid.appendChild(caseEl);
                }
                updateStarDisplay();
            }

            function renderInventory() {
                // –û—á–∏—â–∞–µ–º —Ç–æ–ª—å–∫–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è, –Ω–µ —Ç—Ä–æ–≥–∞—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ–¥–∞—Ç—å –≤—Å–µ"
                inventoryGrid.innerHTML = '';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É "–ü—Ä–æ–¥–∞—Ç—å –≤—Å–µ"
                updateSellAllButton();
                
                if (inventory.length === 0) {
                    inventoryGrid.innerHTML = `<p class="inventory-placeholder" data-t="inventory_empty">${t('inventory_empty')}</p>`;
                    return;
                }

                inventory.forEach(gift => {
                    const giftEl = createGiftElement(gift, 'inventory');
                    const { value } = calculateValue(gift);
                    const upgradeCost = Math.floor(value * 0.5);
                    
                    const actionsDiv = document.createElement('div');
                    actionsDiv.className = 'gift-item-actions';
                    
                    const upgradeBtn = document.createElement('button');
                    upgradeBtn.className = 'upgrade-btn';
                    upgradeBtn.textContent = `${t('upgrade_btn')}`;
                    upgradeBtn.dataset.giftId = gift.id;
                    upgradeBtn.dataset.upgradeCost = upgradeCost;
                    
                    const sellBtn = document.createElement('button');
                    sellBtn.className = 'sell-btn';
                    sellBtn.textContent = `${t('sell_btn')}`;
                    sellBtn.dataset.giftId = gift.id;
                    sellBtn.dataset.sellValue = value;
                    
                    actionsDiv.appendChild(upgradeBtn);
                    actionsDiv.appendChild(sellBtn);
                    giftEl.appendChild(actionsDiv);
                    
                    inventoryGrid.appendChild(giftEl);
                });
            }

            function updateSellAllButton() {
                sellAllContainer.innerHTML = '';
                
                if (inventory.length > 0) {
                    const totalValue = inventory.reduce((sum, gift) => sum + calculateValue(gift).value, 0);
                    
                    const sellAllBtn = document.createElement('button');
                    sellAllBtn.className = 'primary-btn';
                    sellAllBtn.style.backgroundColor = 'var(--red-color)';
                    sellAllBtn.style.fontSize = '1.1rem';
                    sellAllBtn.style.padding = '12px 24px';
                    sellAllBtn.innerHTML = `üí∞ –ü—Ä–æ–¥–∞—Ç—å –≤—Å–µ (${totalValue} üåü)`;
                    sellAllBtn.addEventListener('click', () => {
                        showSellAllConfirm(totalValue);
                    });
                    
                    sellAllContainer.appendChild(sellAllBtn);
                }
            }

            function createGiftElement(gift, context = 'inventory') {
                const giftProto = GIFT_CATALOG[gift.giftId];
                const backdrop = BACKDROPS[gift.backdropId];
                const symbol = SYMBOLS[gift.symbolId];

                const el = document.createElement('div');
                if (context === 'inventory') {
                    el.className = 'gift-item';
                    el.dataset.giftId = gift.id;
                    el.innerHTML = `
                        <div class="gift-icon-wrapper ${backdrop.css_class}">
                            <div class="gift-backdrop-pattern">${backdrop.pattern.repeat(20)}</div>
                            <span class="gift-base-icon">${giftProto.icon}</span>
                            <span class="gift-corner-symbol">${symbol.icon}</span>
                        </div>
                        <span class="gift-name">${giftProto.baseName}</span>
                    `;
                } else if (context === 'inspect') {
                    el.className = 'inspect-gift-art';
                    el.innerHTML = `
                        <div class="gift-icon-wrapper ${backdrop.css_class}">
                            <div class="gift-backdrop-pattern">${backdrop.pattern.repeat(20)}</div>
                            <span class="gift-base-icon">${giftProto.icon}</span>
                            <span class="gift-corner-symbol">${symbol.icon}</span>
                        </div>
                    `;
                }
                return el;
            }

            // --- 7. –Ø–î–†–û - –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê ---
            function calculateValue(gift) {
                const giftProto = GIFT_CATALOG[gift.giftId];
                const backdrop = BACKDROPS[gift.backdropId];
                const symbol = SYMBOLS[gift.symbolId];

                let baseValue = 50;
                let value = baseValue * giftProto.rarity * backdrop.rarity * symbol.rarity;
                
                let hasMultiplier = false;
                if (giftProto.baseColor === backdrop.color && backdrop.color !== 'grey') {
                    value *= 2;
                    hasMultiplier = true;
                }
                
                if (gift.backdropId === 'black_void') {
                    value *= 10;
                    hasMultiplier = true;
                }

                return {
                    value: Math.round(value),
                    hasMultiplier: hasMultiplier
                };
            }

            function generateRandomGift(caseId) {
                const lootTable = CASES[caseId].loot;
                
                const giftId = lootTable.gifts[Math.floor(Math.random() * lootTable.gifts.length)];
                const backdropId = lootTable.backdrops[Math.floor(Math.random() * lootTable.backdrops.length)];
                const symbolId = lootTable.symbols[Math.floor(Math.random() * lootTable.symbols.length)];

                const newGift = {
                    id: Date.now() + Math.random(),
                    giftId: giftId,
                    backdropId: backdropId,
                    symbolId: symbolId
                };
                return newGift;
            }
            
            function getRandomItemByWeight(items) {
                const totalWeight = Object.values(items).reduce((sum, item) => sum + item.weight, 0);
                let random = Math.random() * totalWeight;
                
                for (const id in items) {
                    random -= items[id].weight;
                    if (random <= 0) return id;
                }
                
                return Object.keys(items)[0];
            }
            
            function playUpgradeAnimation(giftId) {
                const giftEl = inventoryGrid.querySelector(`.gift-item[data-gift-id="${giftId}"]`);
                if (giftEl) {
                    giftEl.classList.add('is-upgrading');
                    setTimeout(() => {
                        giftEl.classList.remove('is-upgrading');
                    }, 600);
                }
            }

            // --- 8. –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–¨ –ü–†–û–î–ê–ñ–ò ---
            function sellGift(giftId, sellValue) {
                const gift = inventory.find(g => g.id === giftId);
                if (!gift) return;

                const giftEl = inventoryGrid.querySelector(`.gift-item[data-gift-id="${giftId}"]`);
                if (giftEl) {
                    giftEl.classList.add('selling');
                    
                    setTimeout(() => {
                        inventory = inventory.filter(g => g.id !== giftId);
                        stars += sellValue;
                        saveGame();
                        updateStarDisplay();
                        renderInventory();
                        showSellSuccess(gift, sellValue);
                    }, 600);
                }
            }

            function showSellConfirm(gift, sellValue) {
                const giftProto = GIFT_CATALOG[gift.giftId];
                
                const confirmHtml = `
                    <div class="sell-confirm-modal">
                        <span class="modal-icon">${giftProto.icon}</span>
                        <h4>${t('sell_confirm_title')}</h4>
                        <p>${t('sell_confirm_text')}</p>
                        
                        <div class="sell-price">+${sellValue} üåü</div>
                        
                        <div class="inspect-actions">
                            <button class="primary-btn" id="confirm-sell-btn" data-gift-id="${gift.id}" data-sell-value="${sellValue}">
                                ${t('sell_btn')}
                            </button>
                            <button class="primary-btn" style="background-color: var(--border-color)" data-modal-close>
                                –û—Ç–º–µ–Ω–∞
                            </button>
                        </div>
                        
                        <p class="sell-warning">${t('sell_warning')}</p>
                    </div>
                `;
                showModal(t('sell_confirm_title'), confirmHtml);
            }

            function showSellSuccess(gift, sellValue) {
                const giftProto = GIFT_CATALOG[gift.giftId];
                
                const successHtml = `
                    <div class="sell-confirm-modal">
                        <span class="modal-icon">üí∞</span>
                        <h4>${t('sell_success')}</h4>
                        <p>${giftProto.baseName}</p>
                        
                        <div class="sell-price">+${sellValue} üåü</div>
                        
                        <button class="primary-btn" data-modal-close>
                            OK
                        </button>
                    </div>
                `;
                showModal(t('sell_success'), successHtml);
            }

            function showSellAllConfirm(totalValue) {
                const confirmHtml = `
                    <div class="sell-confirm-modal">
                        <span class="modal-icon">üí∞</span>
                        <h4>–ü—Ä–æ–¥–∞—Ç—å –≤—Å–µ –ø–æ–¥–∞—Ä–∫–∏?</h4>
                        <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥–∞—Ç—å –í–°–ï –ø–æ–¥–∞—Ä–∫–∏ –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è?</p>
                        
                        <div class="sell-price">+${totalValue} üåü</div>
                        
                        <div class="inspect-actions">
                            <button class="primary-btn" id="confirm-sell-all-btn" data-total-value="${totalValue}">
                                –ü—Ä–æ–¥–∞—Ç—å –≤—Å–µ
                            </button>
                            <button class="primary-btn" style="background-color: var(--border-color)" data-modal-close>
                                –û—Ç–º–µ–Ω–∞
                            </button>
                        </div>
                        
                        <p class="sell-warning">–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å! –í—ã –ø–æ—Ç–µ—Ä—è–µ—Ç–µ –≤—Å–µ –ø–æ–¥–∞—Ä–∫–∏.</p>
                    </div>
                `;
                showModal('–ü—Ä–æ–¥–∞—Ç—å –≤—Å–µ –ø–æ–¥–∞—Ä–∫–∏', confirmHtml);
            }

            function sellAllGifts(totalValue) {
                // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–¥–∞–∂–∏ –≤—Å–µ—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤
                const giftItems = inventoryGrid.querySelectorAll('.gift-item');
                giftItems.forEach((item, index) => {
                    setTimeout(() => {
                        item.classList.add('selling');
                    }, index * 100);
                });
                
                setTimeout(() => {
                    stars += totalValue;
                    inventory = [];
                    saveGame();
                    updateStarDisplay();
                    renderInventory();
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–æ–¥–∞–∂–µ
                    const successHtml = `
                        <div class="sell-confirm-modal">
                            <span class="modal-icon">üí∞</span>
                            <h4>–í—Å–µ –ø–æ–¥–∞—Ä–∫–∏ –ø—Ä–æ–¥–∞–Ω—ã!</h4>
                            <p>–í—ã –ø–æ–ª—É—á–∏–ª–∏:</p>
                            <div class="sell-price">+${totalValue} üåü</div>
                            <button class="primary-btn" data-modal-close>
                                OK
                            </button>
                        </div>
                    `;
                    showModal('–ü—Ä–æ–¥–∞–∂–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞', successHtml);
                }, giftItems.length * 100 + 600);
            }

            // --- 9. –ê–ù–ò–ú–ê–¶–ò–Ø –û–¢–ö–†–´–¢–ò–Ø –ö–ï–ô–°–ê ---
            function openCase(caseId) {
                const caseData = CASES[caseId];
                const possibleGifts = caseData.loot.gifts.map(giftId => ({
                    id: giftId,
                    ...GIFT_CATALOG[giftId]
                }));
                
                const openingHtml = `
                    <div class="case-opening-content">
                        <p>${t('opening_case')}</p>
                        <div class="case-spinner-container">
                            <div class="case-spinner-track" id="case-spinner-track">
                                ${createSpinnerItems(possibleGifts, 50)}
                            </div>
                            <div class="case-spinner-highlight"></div>
                        </div>
                    </div>
                `;
                showModal(t(caseData.nameKey), openingHtml);
                
                startCaseSpinnerAnimation(caseId, possibleGifts);
            }

            function createSpinnerItems(items, count) {
                let html = '';
                for (let i = 0; i < count; i++) {
                    const item = items[Math.floor(Math.random() * items.length)];
                    html += `
                        <div class="case-spinner-item" data-item-id="${item.id}">
                            <span class="case-spinner-icon">${item.icon}</span>
                            <span class="case-spinner-name">${item.baseName}</span>
                        </div>
                    `;
                }
                return html;
            }

            function startCaseSpinnerAnimation(caseId, possibleGifts) {
                const newGift = generateRandomGift(caseId);
                const giftProto = GIFT_CATALOG[newGift.giftId];
                
                const track = document.getElementById('case-spinner-track');
                const itemWidth = 100;
                const itemsCount = track.children.length;
                
                const targetIndex = Math.floor(Math.random() * (itemsCount / 3)) + Math.floor(itemsCount * 2 / 3);
                
                let position = 0;
                let speed = 30;
                let animationId;

                function animate() {
                    position += speed;
                    track.style.transform = `translateX(-${position}px`;
                    
                    if (position > targetIndex * itemWidth) {
                        speed = Math.max(2, speed * 0.92);
                    }
                    
                    if (speed > 2) {
                        animationId = requestAnimationFrame(animate);
                    } else {
                        const finalPosition = targetIndex * itemWidth;
                        track.style.transition = 'transform 0.8s ease-out';
                        track.style.transform = `translateX(-${finalPosition}px`;
                        
                        setTimeout(() => {
                            inventory.push(newGift);
                            saveGame();
                            renderInventory();
                            revealCasePrize(giftProto);
                        }, 1000);
                    }
                }
                
                animationId = requestAnimationFrame(animate);
            }

            function revealCasePrize(giftProto) {
                const revealHtml = `
                    <div class="case-reveal-content">
                        <span class="modal-icon">${giftProto.icon}</span>
                        <h4>${t('you_got')}</h4>
                        <p>${giftProto.baseName}</p>
                    </div>
                `;
                modalBody.innerHTML = revealHtml;
            }

            // --- 10. –ê–ù–ò–ú–ê–¶–ò–Ø –£–õ–£–ß–®–ï–ù–ò–Ø –ü–û–î–ê–†–ö–ê ---
            function upgradeGift(giftId, upgradeCost) {
                const gift = inventory.find(g => g.id === giftId);
                if (!gift) return;

                if (stars < upgradeCost) {
                    showAlert(t('not_enough_stars'), `${t('alert_need_stars')} ${upgradeCost} üåü ${t('alert_to_upgrade')}.`);
                    return;
                }

                stars -= upgradeCost;
                saveGame();
                updateStarDisplay();

                const upgradeHtml = `
                    <div class="upgrade-opening-content">
                        <p>${t('upgrading_gift')}</p>
                        <div class="upgrade-spinner-container">
                            <div class="upgrade-spinner-track" id="backdrop-spinner-track">
                                ${createUpgradeSpinnerItems(BACKDROPS, 50, 'backdrop')}
                            </div>
                            <div class="upgrade-spinner-highlight"></div>
                        </div>
                    </div>
                `;
                showModal(t('upgrading_gift'), upgradeHtml);
                
                startUpgradeSpinnerAnimation(gift, 'backdrop');
            }

            function createUpgradeSpinnerItems(items, count, type) {
                let html = '';
                const itemIds = Object.keys(items);
                
                for (let i = 0; i < count; i++) {
                    const randomId = itemIds[Math.floor(Math.random() * itemIds.length)];
                    const item = items[randomId];
                    const displayIcon = type === 'backdrop' ? item.pattern : item.icon;
                    const displayName = item.name;
                    
                    html += `
                        <div class="upgrade-spinner-item" data-item-id="${randomId}" data-item-type="${type}">
                            <span class="upgrade-spinner-icon">${displayIcon}</span>
                            <span class="upgrade-spinner-name">${displayName}</span>
                        </div>
                    `;
                }
                return html;
            }

            function startUpgradeSpinnerAnimation(gift, type) {
                const track = document.getElementById(`${type}-spinner-track`);
                const itemWidth = 100;
                const itemsCount = track.children.length;
                
                const targetId = getRandomItemByWeight(type === 'backdrop' ? BACKDROPS : SYMBOLS);
                const targetIndex = Math.floor(Math.random() * (itemsCount / 3)) + Math.floor(itemsCount * 2 / 3);
                
                let position = 0;
                let speed = 30;
                let animationId;

                function animate() {
                    position += speed;
                    track.style.transform = `translateX(-${position}px`;
                    
                    if (position > targetIndex * itemWidth) {
                        speed = Math.max(2, speed * 0.92);
                    }
                    
                    if (speed > 2) {
                        animationId = requestAnimationFrame(animate);
                    } else {
                        const finalPosition = targetIndex * itemWidth;
                        track.style.transition = 'transform 0.8s ease-out';
                        track.style.transform = `translateX(-${finalPosition}px`;
                        
                        setTimeout(() => {
                            if (type === 'backdrop') {
                                gift.backdropId = targetId;
                                revealUpgradePrize(BACKDROPS[targetId], 'backdrop', gift);
                            } else {
                                gift.symbolId = targetId;
                                revealUpgradePrize(SYMBOLS[targetId], 'symbol', gift);
                                setTimeout(() => {
                                    playUpgradeAnimation(gift.id);
                                    saveGame();
                                    renderInventory();
                                    showInspectModal(gift);
                                }, 2000);
                            }
                        }, 1000);
                    }
                }
                
                animationId = requestAnimationFrame(animate);
            }

            function revealUpgradePrize(item, type, gift) {
                const title = type === 'backdrop' ? t('new_backdrop') : t('new_symbol');
                const revealHtml = `
                    <div class="upgrade-reveal-content">
                        <span class="modal-icon">${type === 'backdrop' ? item.pattern : item.icon}</span>
                        <h4>${title}</h4>
                        <p>${item.name}</p>
                    </div>
                `;
                modalBody.innerHTML = revealHtml;
                
                if (type === 'backdrop') {
                    setTimeout(() => {
                        const symbolHtml = `
                            <div class="upgrade-opening-content">
                                <p>${t('upgrading_gift')}</p>
                                <div class="upgrade-spinner-container">
                                    <div class="upgrade-spinner-track" id="symbol-spinner-track">
                                        ${createUpgradeSpinnerItems(SYMBOLS, 50, 'symbol')}
                                    </div>
                                    <div class="upgrade-spinner-highlight"></div>
                                </div>
                            </div>
                        `;
                        modalBody.innerHTML = symbolHtml;
                        startUpgradeSpinnerAnimation(gift, 'symbol');
                    }, 2000);
                }
            }

            // --- 11. –ë–ò–¢–í–ê –° –ë–û–¢–û–ú ---
            let selectedBattleCase = null;
            let battleCount = 1;

            function showBattleModal() {
                const battleHtml = `
                    <div class="battle-section">
                        <h4>${t('battle_select_cases')}</h4>
                        <div class="battle-options" id="battle-options">
                            ${Object.keys(CASES).map(caseId => `
                                <div class="battle-option ${selectedBattleCase === caseId ? 'selected' : ''}" data-case-id="${caseId}">
                                    <div class="battle-option-icon">${CASES[caseId].icon}</div>
                                    <div class="battle-option-name">${t(CASES[caseId].nameKey)}</div>
                                    <div class="battle-option-cost">${CASES[caseId].cost} üåü</div>
                                </div>
                            `).join('')}
                        </div>

                        <h4>${t('battle_select_count')}</h4>
                        <div class="battle-count-selector">
                            <button class="count-btn" id="decrease-count" ${battleCount <= 1 ? 'disabled' : ''}>-</button>
                            <div class="battle-count">${battleCount}</div>
                            <button class="count-btn" id="increase-count" ${battleCount >= 10 ? 'disabled' : ''}>+</button>
                        </div>

                        ${selectedBattleCase ? `
                            <div class="battle-total">
                                ${t('battle_total_cost')}: ${CASES[selectedBattleCase].cost * battleCount} üåü
                            </div>
                            <button class="battle-btn" id="start-battle-btn" ${stars < CASES[selectedBattleCase].cost * battleCount ? 'disabled' : ''}>
                                ${t('battle_start')}
                            </button>
                        ` : ''}
                    </div>
                `;
                showModal(t('battle_title'), battleHtml);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ –∫–µ–π—Å–æ–≤
                document.querySelectorAll('.battle-option').forEach(option => {
                    option.addEventListener('click', () => {
                        selectedBattleCase = option.dataset.caseId;
                        showBattleModal(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                    });
                });
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
                document.getElementById('decrease-count').addEventListener('click', () => {
                    if (battleCount > 1) {
                        battleCount--;
                        showBattleModal();
                    }
                });
                
                document.getElementById('increase-count').addEventListener('click', () => {
                    if (battleCount < 10) {
                        battleCount++;
                        showBattleModal();
                    }
                });
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –Ω–∞—á–∞–ª–∞ –±–∏—Ç–≤—ã
                const startBattleBtn = document.getElementById('start-battle-btn');
                if (startBattleBtn) {
                    startBattleBtn.addEventListener('click', startBattle);
                }
            }

            function startBattle() {
                if (!selectedBattleCase) return;
                
                const totalCost = CASES[selectedBattleCase].cost * battleCount;
                if (stars < totalCost) {
                    showAlert(t('not_enough_stars'), `${t('alert_need_stars')} ${totalCost} üåü ${t('alert_to_buy')}.`);
                    return;
                }

                // –°–Ω–∏–º–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å
                stars -= totalCost;
                saveGame();
                updateStarDisplay();

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –±–∏—Ç–≤—ã
                const battleHtml = `
                    <div class="battle-result">
                        <h4>${t('battle_processing')}</h4>
                        <div class="case-spinner-container">
                            <div class="case-spinner-track" id="battle-spinner-track">
                                ${createSpinnerItems(Object.values(GIFT_CATALOG), 50)}
                            </div>
                            <div class="case-spinner-highlight"></div>
                        </div>
                    </div>
                `;
                modalBody.innerHTML = battleHtml;

                // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∏ –ª–æ–≥–∏–∫—É –±–∏—Ç–≤—ã
                setTimeout(() => {
                    processBattle();
                }, 3000);
            }

            function processBattle() {
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–æ–¥–∞—Ä–∫–∏ –¥–ª—è –∏–≥—Ä–æ–∫–∞ –∏ –±–æ—Ç–∞
                const playerGifts = [];
                const botGifts = [];
                
                for (let i = 0; i < battleCount; i++) {
                    playerGifts.push(generateRandomGift(selectedBattleCase));
                    botGifts.push(generateRandomGift(selectedBattleCase));
                }
                
                // –°—á–∏—Ç–∞–µ–º –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å
                const playerTotal = playerGifts.reduce((sum, gift) => sum + calculateValue(gift).value, 0);
                const botTotal = botGifts.reduce((sum, gift) => sum + calculateValue(gift).value, 0);
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
                let resultMessage = '';
                let winner = '';
                
                if (playerTotal > botTotal) {
                    // –ò–≥—Ä–æ–∫ –ø–æ–±–µ–¥–∏–ª - –∑–∞–±–∏—Ä–∞–µ—Ç –≤—Å–µ –ø–æ–¥–∞—Ä–∫–∏
                    inventory.push(...playerGifts, ...botGifts);
                    resultMessage = t('battle_win_message');
                    winner = t('battle_player');
                } else if (botTotal > playerTotal) {
                    // –ë–æ—Ç –ø–æ–±–µ–¥–∏–ª - –∏–≥—Ä–æ–∫ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç
                    inventory.push(...playerGifts); // –ò–≥—Ä–æ–∫ –æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–≤–æ–∏ –ø–æ–¥–∞—Ä–∫–∏
                    resultMessage = t('battle_lose_message');
                    winner = t('battle_bot');
                } else {
                    // –ù–∏—á—å—è - –∫–∞–∂–¥—ã–π –æ—Å—Ç–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–≤–æ–∏—Ö
                    inventory.push(...playerGifts);
                    resultMessage = t('battle_draw_message');
                    winner = 'Draw';
                }
                
                saveGame();
                renderInventory();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                const resultHtml = `
                    <div class="battle-result">
                        <h4>${t('battle_title')}</h4>
                        
                        <div class="battle-comparison">
                            <div class="battle-player">
                                <h4>${t('battle_player')}</h4>
                                <div class="battle-value">${playerTotal} üåü</div>
                                <div>${playerGifts.length} ${t('inspect_title')}</div>
                            </div>
                            <div class="battle-bot">
                                <h4>${t('battle_bot')}</h4>
                                <div class="battle-value">${botTotal} üåü</div>
                                <div>${botGifts.length} ${t('inspect_title')}</div>
                            </div>
                        </div>
                        
                        ${winner !== 'Draw' ? `
                            <div class="battle-winner">${t('battle_winner')}: ${winner}</div>
                        ` : `
                            <div class="battle-winner">${winner}</div>
                        `}
                        
                        <p>${resultMessage}</p>
                        
                        <button class="primary-btn" data-modal-close>
                            OK
                        </button>
                    </div>
                `;
                modalBody.innerHTML = resultHtml;
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∏—Ç–≤—ã
                selectedBattleCase = null;
                battleCount = 1;
            }

            // --- 12. –¢–†–ï–ô–î–´ –° –ë–û–¢–û–ú ---
            let selectedPlayerGifts = [];

            function showTradeModal() {
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –±–æ—Ç–∞ (1-3 —Å–ª—É—á–∞–π–Ω—ã—Ö –ø–æ–¥–∞—Ä–∫–∞)
                const botGiftsCount = Math.floor(Math.random() * 3) + 1;
                const botGifts = [];
                
                for (let i = 0; i < botGiftsCount; i++) {
                    // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –∫–µ–π—Å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ–¥–∞—Ä–∫–∞
                    const caseIds = Object.keys(CASES);
                    const randomCaseId = caseIds[Math.floor(Math.random() * caseIds.length)];
                    botGifts.push(generateRandomGift(randomCaseId));
                }
                
                // –°—á–∏—Ç–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –±–æ—Ç–∞
                const botValue = botGifts.reduce((sum, gift) => sum + calculateValue(gift).value, 0);
                
                const tradeHtml = `
                    <div class="trade-section">
                        <h4>${t('trade_select')}</h4>
                        
                        <div class="trade-container">
                            <div class="trade-column player">
                                <h4>${t('trade_player')}</h4>
                                <div class="trade-gifts" id="player-trade-gifts">
                                    ${inventory.map(gift => {
                                        const giftProto = GIFT_CATALOG[gift.giftId];
                                        const isSelected = selectedPlayerGifts.some(g => g.id === gift.id);
                                        return `
                                            <div class="trade-gift-item ${isSelected ? 'selected' : ''}" data-gift-id="${gift.id}">
                                                <div class="trade-gift-icon">${giftProto.icon}</div>
                                                <div class="trade-gift-name">${giftProto.baseName}</div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                            
                            <div class="trade-column bot">
                                <h4>${t('trade_bot')}</h4>
                                <div class="trade-gifts" id="bot-trade-gifts">
                                    ${botGifts.map(gift => {
                                        const giftProto = GIFT_CATALOG[gift.giftId];
                                        return `
                                            <div class="trade-gift-item">
                                                <div class="trade-gift-icon">${giftProto.icon}</div>
                                                <div class="trade-gift-name">${giftProto.baseName}</div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                        </div>
                        
                        <div class="trade-summary">
                            <div class="trade-value">
                                <div class="trade-value-label">${t('trade_player')}</div>
                                <div class="trade-value-amount" id="player-trade-value">0 üåü</div>
                            </div>
                            <div class="trade-value">
                                <div class="trade-value-label">${t('trade_bot')}</div>
                                <div class="trade-value-amount">${botValue} üåü</div>
                            </div>
                        </div>
                        
                        <div class="trade-actions">
                            <button class="primary-btn accept-btn" id="accept-trade-btn">
                                ${t('trade_accept')}
                            </button>
                            <button class="primary-btn reject-btn" id="reject-trade-btn">
                                ${t('trade_reject')}
                            </button>
                        </div>
                    </div>
                `;
                showModal(t('trade_title'), tradeHtml);
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–¥–∞—Ä–∫–∏ –±–æ—Ç–∞ –≤ data-–∞—Ç—Ä–∏–±—É—Ç–µ
                document.getElementById('bot-trade-gifts').dataset.botGifts = JSON.stringify(botGifts);
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–æ–¥–∞—Ä–∫–æ–≤ –∏–≥—Ä–æ–∫–∞
                document.querySelectorAll('#player-trade-gifts .trade-gift-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const giftId = parseFloat(item.dataset.giftId);
                        const gift = inventory.find(g => g.id === giftId);
                        
                        if (item.classList.contains('selected')) {
                            // –£–±–∏—Ä–∞–µ–º –∏–∑ –≤—ã–±–æ—Ä–∞
                            item.classList.remove('selected');
                            selectedPlayerGifts = selectedPlayerGifts.filter(g => g.id !== giftId);
                        } else {
                            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –≤—ã–±–æ—Ä
                            item.classList.add('selected');
                            selectedPlayerGifts.push(gift);
                        }
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å
                        updateTradeValues();
                    });
                });
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
                document.getElementById('accept-trade-btn').addEventListener('click', acceptTrade);
                document.getElementById('reject-trade-btn').addEventListener('click', () => {
                    selectedPlayerGifts = [];
                    hideModal();
                });
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å
                updateTradeValues();
            }

            function updateTradeValues() {
                const playerValue = selectedPlayerGifts.reduce((sum, gift) => sum + calculateValue(gift).value, 0);
                document.getElementById('player-trade-value').textContent = `${playerValue} üåü`;
            }

            function acceptTrade() {
                if (selectedPlayerGifts.length === 0) {
                    showAlert(t('trade_no_selection'), t('trade_no_selection'));
                    return;
                }
                
                // –ü–æ–ª—É—á–∞–µ–º –ø–æ–¥–∞—Ä–∫–∏ –±–æ—Ç–∞
                const botGifts = JSON.parse(document.getElementById('bot-trade-gifts').dataset.botGifts);
                
                // –°—á–∏—Ç–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–¥–∞—Ä–∫–æ–≤ –∏–≥—Ä–æ–∫–∞ –∏ –±–æ—Ç–∞
                const playerValue = selectedPlayerGifts.reduce((sum, gift) => sum + calculateValue(gift).value, 0);
                const botValue = botGifts.reduce((sum, gift) => sum + calculateValue(gift).value, 0);
                
                // –ë–æ—Ç —Å–æ–≥–ª–∞—à–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ä–∞–∑–Ω–∏—Ü–∞ –≤ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç 15%
                const maxDifference = 0.15; // 15%
                const difference = Math.abs(playerValue - botValue) / Math.max(playerValue, botValue);
                
                if (difference > maxDifference) {
                    showAlert(t('trade_rejected'), '–ë–æ—Ç –æ—Ç–∫–ª–æ–Ω—è–µ—Ç —Å–¥–µ–ª–∫—É');
                    return;
                }
                
                // –£–¥–∞–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏ –∏–≥—Ä–æ–∫–∞ –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
                selectedPlayerGifts.forEach(gift => {
                    inventory = inventory.filter(g => g.id !== gift.id);
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–∞—Ä–∫–∏ –±–æ—Ç–∞ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
                inventory.push(...botGifts);
                
                saveGame();
                renderInventory();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                const resultHtml = `
                    <div class="trade-result">
                        <h4>${t('trade_title')}</h4>
                        <div class="trade-success">${t('trade_success')}</div>
                        <p>${t('trade_success')}</p>
                        <button class="primary-btn" data-modal-close>
                            OK
                        </button>
                    </div>
                `;
                modalBody.innerHTML = resultHtml;
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä
                selectedPlayerGifts = [];
            }

            // --- 13. –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô ---
            function handleStarClick(event) {
                stars += 1;
                updateStarDisplay();
                saveGame();

                const floatingText = document.createElement('span');
                floatingText.classList.add('floating-text');
                floatingText.textContent = `+1`;
                
                const rect = clickerContainer.getBoundingClientRect();
                const x = event.clientX - rect.left - 20;
                const y = event.clientY - rect.top - 30;
                
                floatingText.style.left = `${x}px`;
                floatingText.style.top = `${y}px`;
                clickerContainer.appendChild(floatingText);

                setTimeout(() => {
                    floatingText.remove();
                }, 1000);
            }

            function handleBuyCase(event) {
                const btn = event.target.closest('button');
                if (!btn) return;
                
                const caseId = btn.dataset.caseId;
                const caseData = CASES[caseId];

                if (stars >= caseData.cost) {
                    stars -= caseData.cost;
                    updateStarDisplay();
                    saveGame();
                    openCase(caseId);
                } else {
                    showAlert(t('not_enough_stars'), `${t('alert_need_stars')} ${caseData.cost} üåü ${t('alert_to_buy')} ${t(caseData.nameKey)}`);
                }
            }

            function handleInspectGift(event) {
                const giftItem = event.target.closest('.gift-item');
                if (!giftItem) return;
                
                const giftId = parseFloat(giftItem.dataset.giftId);
                const gift = inventory.find(g => g.id === giftId);
                if (gift) {
                    showInspectModal(gift);
                }
            }
            
            function handleUpgradeGift(event) {
                const upgradeBtn = event.target.closest('.upgrade-btn');
                if (!upgradeBtn) return;
                
                const giftId = parseFloat(upgradeBtn.dataset.giftId);
                const upgradeCost = parseInt(upgradeBtn.dataset.upgradeCost, 10);
                
                upgradeGift(giftId, upgradeCost);
            }

            function handleSellGift(event) {
                const sellBtn = event.target.closest('.sell-btn');
                if (!sellBtn) return;
                
                const giftId = parseFloat(sellBtn.dataset.giftId);
                const sellValue = parseInt(sellBtn.dataset.sellValue, 10);
                const gift = inventory.find(g => g.id === giftId);
                
                if (gift) {
                    showSellConfirm(gift, sellValue);
                }
            }

            function handleSettingsClick() {
                showSettingsModal();
            }

            function handleBattleClick() {
                showBattleModal();
            }

            function handleTradeClick() {
                showTradeModal();
            }

            // --- 14. –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê ---
            function showModal(titleKey, contentHtml) {
                modalTitle.textContent = t(titleKey);
                modalBody.innerHTML = contentHtml;
                modalBackdrop.style.display = 'flex';
            }

            function hideModal() {
                modalBackdrop.style.display = 'none';
            }

            function showAlert(title, message) {
                const alertHtml = `
                    <h4>${title}</h4>
                    <p>${message}</p>
                `;
                showModal('Alert', alertHtml);
                modalTitle.textContent = title;
            }

            function showInspectModal(gift) {
                const giftProto = GIFT_CATALOG[gift.giftId];
                const backdrop = BACKDROPS[gift.backdropId];
                const symbol = SYMBOLS[gift.symbolId];
                const { value, hasMultiplier } = calculateValue(gift);
                const upgradeCost = Math.floor(value * 0.5);

                const inspectHtml = `
                    ${createGiftElement(gift, 'inspect').outerHTML}
                    
                    <div class="inspect-gift-info">
                        <dl class="inspect-info-grid">
                            <dt>${t('inspect_owner')}</dt>
                            <dd>${t('inspect_owner_you')}</dd>
                            
                            <dt>${t('inspect_model')}</dt>
                            <dd>${giftProto.baseName}</dd>
                            
                            <dt>${t('inspect_backdrop')}</dt>
                            <dd>${backdrop.name}</dd>
                            
                            <dt>${t('inspect_symbol')}</dt>
                            <dd>${symbol.name}</dd>
                            
                            <dt>${t('inspect_availability')}</dt>
                            <dd>1 / 1</dd>
                            
                            <dt>${t('inspect_value')}</dt>
                            <dd class="value ${hasMultiplier ? 'multiplier' : ''}">
                                ${value} üåü ${hasMultiplier ? '(–ë–æ–Ω—É—Å!)' : ''}
                            </dd>
                        </dl>
                    </div>

                    <div class="inspect-actions">
                        <button class="primary-btn" id="inspect-upgrade-btn" data-gift-id="${gift.id}" data-upgrade-cost="${upgradeCost}">
                            ${t('upgrade_btn')} (${upgradeCost} üåü)
                        </button>
                        <button class="primary-btn" style="background-color: var(--red-color)" id="inspect-sell-btn" data-gift-id="${gift.id}" data-sell-value="${value}">
                            ${t('sell_btn')} (${value} üåü)
                        </button>
                    </div>
                `;
                showModal('inspect_title', inspectHtml);
            }
            
            function showSettingsModal() {
                const settingsHtml = `
                    <div class="settings-content">
                        <h4 style="margin-bottom: 10px;">${t('settings_lang')}</h4>
                        <div class="lang-switcher">
                            <button class="lang-btn ${currentLanguage === 'ru' ? 'active' : ''}" data-lang="ru">–†—É—Å—Å–∫–∏–π</button>
                            <button class="lang-btn ${currentLanguage === 'en' ? 'active' : ''}" data-lang="en">English</button>
                        </div>
                    </div>
                `;
                showModal('settings_title', settingsHtml);
            }

            // --- 15. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò –û–ë–©–ò–ï –°–õ–£–®–ê–¢–ï–õ–ò ---
            clickerContainer.addEventListener('pointerdown', handleStarClick);
            storeGrid.addEventListener('click', handleBuyCase);
            inventoryGrid.addEventListener('click', (e) => {
                if (e.target.closest('.upgrade-btn')) {
                    handleUpgradeGift(e);
                } else if (e.target.closest('.sell-btn')) {
                    handleSellGift(e);
                } else {
                    handleInspectGift(e);
                }
            });
            settingsBtn.addEventListener('click', handleSettingsClick);
            battleBtn.addEventListener('click', handleBattleClick);
            tradeBtn.addEventListener('click', handleTradeClick);

            modalBackdrop.addEventListener('click', (e) => {
                if (e.target === modalBackdrop || e.target.closest('[data-modal-close]')) {
                    hideModal();
                }
                
                const langBtn = e.target.closest('.lang-btn');
                if (langBtn) {
                    setLanguage(langBtn.dataset.lang);
                    showSettingsModal();
                }
                
                const inspectUpgradeBtn = e.target.closest('#inspect-upgrade-btn');
                if (inspectUpgradeBtn) {
                    const giftId = parseFloat(inspectUpgradeBtn.dataset.giftId);
                    const upgradeCost = parseInt(inspectUpgradeBtn.dataset.upgradeCost, 10);
                    upgradeGift(giftId, upgradeCost);
                }
                
                const inspectSellBtn = e.target.closest('#inspect-sell-btn');
                if (inspectSellBtn) {
                    const giftId = parseFloat(inspectSellBtn.dataset.giftId);
                    const sellValue = parseInt(inspectSellBtn.dataset.sellValue, 10);
                    const gift = inventory.find(g => g.id === giftId);
                    if (gift) {
                        showSellConfirm(gift, sellValue);
                    }
                }
                
                const confirmSellBtn = e.target.closest('#confirm-sell-btn');
                if (confirmSellBtn) {
                    const giftId = parseFloat(confirmSellBtn.dataset.giftId);
                    const sellValue = parseInt(confirmSellBtn.dataset.sellValue, 10);
                    sellGift(giftId, sellValue);
                }

                const confirmSellAllBtn = e.target.closest('#confirm-sell-all-btn');
                if (confirmSellAllBtn) {
                    const totalValue = parseInt(confirmSellAllBtn.dataset.totalValue, 10);
                    sellAllGifts(totalValue);
                }
            });

            // –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫
            loadGame();
        });
    </script>
</body>
</html>
